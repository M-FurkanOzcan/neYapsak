<script>
// Sayfa yüklendiğinde favori durumunu kontrol et
document.addEventListener('DOMContentLoaded', async () => {
    const token = localStorage.getItem('token');
    if (!token) {
        const favoriteButton = document.getElementById('favoriteButton');
        if (favoriteButton) {
            favoriteButton.parentElement.innerHTML = `
                <a href="/auth/login" class="btn btn-dark">
                    Favorilere eklemek için giriş yapın
                </a>
            `;
        }
        return;
    }

    try {
        const response = await fetchWithAuth('/api/favorites');
        if (!response) return;

        const favorites = await response.json();
        const isFavorite = favorites.some(fav => fav._id === '<%= recipe._id %>');
        
        const button = document.getElementById('favoriteButton');
        if (button) {
            if (isFavorite) {
                button.innerHTML = '<i class="bi bi-heart-fill"></i> Favorilerden Çıkar';
                button.classList.remove('btn-dark');
                button.classList.add('btn-danger');
            } else {
                button.innerHTML = '<i class="bi bi-heart"></i> Favorilere Ekle';
                button.classList.remove('btn-danger');
                button.classList.add('btn-dark');
            }
        }
    } catch (error) {
        console.error('Hata:', error);
    }
});

// Favori ekle/çıkar
async function toggleFavorite(recipeId) {
    const token = localStorage.getItem('token');
    if (!token) {
        window.location.href = '/auth/login';
        return;
    }

    const button = document.getElementById('favoriteButton');
    const isFavorite = button.classList.contains('btn-danger');

    try {
        const response = await fetchWithAuth(`/api/favorites/${recipeId}`, {
            method: isFavorite ? 'DELETE' : 'POST'
        });

        if (!response) return;

        // Buton durumunu güncelle
        if (isFavorite) {
            button.innerHTML = '<i class="bi bi-heart"></i> Favorilere Ekle';
            button.classList.remove('btn-danger');
            button.classList.add('btn-dark');
        } else {
            button.innerHTML = '<i class="bi bi-heart-fill"></i> Favorilerden Çıkar';
            button.classList.remove('btn-dark');
            button.classList.add('btn-danger');
        }
    } catch (error) {
        console.error('Hata:', error);
        alert('İşlem sırasında bir hata oluştu');
    }
}
</script> 